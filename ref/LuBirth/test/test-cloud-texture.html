<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云层贴图测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 5px;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .loading {
            color: #FF9800;
        }
        img {
            max-width: 200px;
            height: auto;
            border: 1px solid #444;
            margin: 5px 0;
        }
        .texture-info {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>云层贴图加载测试</h1>
        <p>请通过开发服务器访问此页面 (http://localhost:5173/test-cloud-texture.html)</p>
        <div id="test-results"></div>
        <button onclick="clearCache()">清除缓存并重新测试</button>
    </div>

    <script>
        const testPaths = [
            '/textures/8k_earth_clouds.jpg',
            '/textures/2k_earth_clouds.jpg',
            'textures/8k_earth_clouds.jpg',
            'textures/2k_earth_clouds.jpg'
        ];

        const testResults = document.getElementById('test-results');

        function testImageLoad(path) {
            return new Promise((resolve) => {
                const img = new Image();
                const startTime = Date.now();
                
                const testItem = document.createElement('div');
                testItem.className = 'test-item loading';
                testItem.innerHTML = `正在测试: ${path}`;
                testResults.appendChild(testItem);

                img.onload = function() {
                    const loadTime = Date.now() - startTime;
                    testItem.className = 'test-item success';
                    testItem.innerHTML = `
                        <div>✅ 成功: ${path}</div>
                        <div class="texture-info">加载时间: ${loadTime}ms | 尺寸: ${img.naturalWidth}x${img.naturalHeight}</div>
                        <img src="${path}" alt="Cloud texture">
                    `;
                    resolve({ path, success: true, loadTime, width: img.naturalWidth, height: img.naturalHeight });
                };

                img.onerror = function() {
                    const loadTime = Date.now() - startTime;
                    testItem.className = 'test-item error';
                    testItem.innerHTML = `
                        <div>❌ 失败: ${path}</div>
                        <div class="texture-info">加载时间: ${loadTime}ms</div>
                        <div>错误: 无法加载图片资源</div>
                    `;
                    resolve({ path, success: false, loadTime });
                };

                // 添加时间戳防止缓存
                img.src = `${path}?t=${Date.now()}`;
            });
        }

        async function runTests() {
            console.log('开始测试云层贴图加载...');
            testResults.innerHTML = '';
            
            for (const path of testPaths) {
                await testImageLoad(path);
                await new Promise(resolve => setTimeout(resolve, 500)); // 延迟500ms
            }

            console.log('所有测试完成');
        }

        function clearCache() {
            // 清除图片缓存
            testPaths.forEach(path => {
                const img = new Image();
                img.src = path + '?t=' + Date.now();
            });
            
            // 重新测试
            setTimeout(runTests, 100);
        }

        // 页面加载完成后运行测试
        window.addEventListener('load', runTests);
    </script>
</body>
</html>