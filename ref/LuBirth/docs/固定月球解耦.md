下面给你一套“与镜头解耦”的方向约束与坐标约定，专门满足你的目标：月亮固定在屏幕位置 (x=0.5, y=0.75) 展示真实月相和潮汐锁定面，同时镜头可绕地球旋转，且月球不接入 three 的场
景光。

坐标与基向量

- 世界系: 保持现有约定 Y-up，ECEF→World 为 World(x,y,z)=ECEF(x,z,y)，右手系。
- 月面局部系 L（用于月相/潮锁/着色，只服务月球，不受相机约束）:
    - Z_L: 指向“地球方向”的单位向量（Moon→Earth），定义为“正对近地点面”的法向。这样“潮汐锁定面”天然居中。
    - U_ref: 参考“上方向”。优先用世界 +Y 投影到月盘切平面；若投影退化，退回“观察者本地 Up（ENU.Up）”或“相机 Up”。
    - R_L: 右向，R_L = normalize(cross(Z_L, U_ref))。
    - U_L: 上向，U_L = cross(R_L, Z_L)。确保 L 为右手系。
    - 作用: L 系完全锚定在“地球-月球”关系和全局 Up 上，镜头绕地球旋转不会改变月盘左右/上下的物理语义。

光照与月相（统一内部着色）

- 光向量: 用“点到光”的方向，避免 Lambert 反号镜像。
    - S_world: Moon→Sun（点到光），而不是 Sun→Moon。
    - S_L: 将 S_world 变换/投影到 L 系（尤其是月盘切平面上），用来决定明暗界与“哪边更亮”。
- 相位角只作为验证，不再驱动左右:
    - 直接用 S_L 的 R/U 分量决定亮侧与“新/上/满/下”四象限，更稳健也更符合潮汐/倾角变化。
    - 如需“左满右”（语义上：盈月右亮、亏月左亮），只需确保 R_L 指向“屏幕右”，同时 S_world 的定义为“点到光”。这两者一旦一致，视觉周期自然满足“右盈左亏”。

潮汐锁定与贴图经度 -90° 的统一

- lon=-90° 是贴图与真实月面经线对齐的固定偏移。把它“烘焙”为 L 系与贴图坐标的绑定：
    - 约定：当观察位于地球（Z_L 朝向观察者）且 S 与 +F 共线（满月）时，贴图中央经线对应 sub‑Earth 子午圈；经度 -90° 后“纹理东向”与 R_L 对齐。
    - 简化心智模型：不要再让“相机锁相位”去驱动“旋转贴图”。贴图的基准只跟 L 系绑定（Z_L 与 lon=-90°），相机如何动与贴图取向无关。

几何呈现与屏幕定位（与相机解耦）

- 屏幕定位: 继续用 NDC 反投影将月球放到 (0.5, 0.75) 的射线深度上（这只是“显示壳位姿”）。
- 面向镜头: 几何可以 billboard（法向对准相机射线）以获得一个始终正对屏幕的“月盘”。
- 解耦关键: “几何壳”的面向用于显示，不参与月相/潮锁。月相/潮锁在“着色器/内部计算”里只使用 L 系与 S_world，不读取几何的旋转，也不读取相机基向量。

“镜头绕地球”时保持正确的月盘倾斜

- 若需要正确的“弦月倾角”（即亮暗界相对屏幕上/下的旋转），用 U_ref 的选择来表达：
    - 优先使用世界 +Y（全球一致），必要时按观察者位置改用 ENU.Up 投影，这样“月盘朝上”的参照在不同纬度/姿态下更贴近真实视感（相当于引入“视差角/视放角”）。
    - R_L、U_L 随 U_ref 重建，亮暗界自然随地理与季节变化倾斜，但不随相机轨道而乱转。

符号与一致性要点

- 右手系: World 与 L 都保持右手系；R_L 指向“屏幕右”（验证方式：将 R_L 投影到屏幕，右移为正）。
- 光向量方向: 统一“点到光”（Moon→Sun）。片元着色用 dot(normal, L_dir)，避免再人为取反。
- 贴图经度 -90°: 作为 L→纹理空间的固定偏移，不交给“相机锁相位”逻辑；相机“只影响看到的哪里”，不影响“月面坐标系”。
- 禁用场景光: 月球只吃自己的 S_world 和 L 系；不受 three 的 DirectionalLight/HemisphereLight 影响。

渲染管线建议（概念步骤）

- 物理层（每帧）:
    - 取 Earth_world（地球中心）、Moon_world、Sun_world。
    - Z_L = normalize(Earth_world − Moon_world)。
    - U_ref = project(+Y_world, plane ⟂ Z_L)；退化用 ENU.Up 或 Camera.Up。
    - R_L,U_L 构建右手系。
    - S_world = normalize(Sun_world − Moon_world)（点到光），得 S_L（或投影到盘面）。
- 显示层（每帧）:
    - 计算固定屏幕坐标对应的相机射线，放置月球几何到指定深度；几何 billboard 面向相机。
    - 将 L 系与 S_world 作为 uniform 传入月球内部着色；贴图取样用“L→纹理”的固定 -90° 偏移。
    - 潮汐锁定=使用 Z_L 作为“面朝基准”，不读取相机方向；相机轨道只改变地球主画面的构图，Moon PIP 始终稳定。

边界与回退

- 当 Z_L 与 U_ref 共线导致投影变小（极端几何），自动切到 Camera.Up 维持稳定（避免“上方向”抖动）。
- 近满/近新月时，亮暗界接近平行/消失，使用小阈值稳定化 alpha 过渡，避免“跳向另一侧”。

验证清单

- 固定镜头绕地球 360°：PIP 月盘位置不动、亮暗界不换边、倾角符合季节/纬度变化而非相机轨道。
- 按月相序列（每晚 1 小步）：盈→满→亏，“右亮→正面→左亮”；贴图地形不漂移（潮锁面稳定）。
- 切换“U_ref=+Y_world”与“U_ref=ENU.Up”：弦月倾角在高纬/不同经度变化趋势合理。

这套约束的核心是“几何显示与物理月相彻底解耦”：几何只负责把月亮摆在屏幕位置并正对相机；物理月相与潮锁只看 Earth/Moon/Sun 三者关系构建 L 系与光向量。只要坚持“点到光”的方向和右手
系，且把贴图 -90° 当作 L→纹理的固定偏移，视觉就会稳定地呈现你要的“固定位置 + 正确相位 + 正确潮锁面”，且不受相机绕行的影响。