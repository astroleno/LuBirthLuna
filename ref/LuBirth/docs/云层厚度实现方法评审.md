  融合方案分析

  🎯 核心优势

  1. 分层策略：全局用多层球体（方案B），局部用动态patch（
  方案A）
  2. 性能优化：根据视角动态调整细节级别
  3. 视觉提升：既保证全景厚度感，又提供近景细节

  ⚠️ 技术挑战

  1. 性能担忧

  - 5层球体 × 128段几何体 = 大量顶点计算
  - 动态patch的位置更新可能影响帧率
  - React Three Fiber中管理多个mesh的状态复杂性

  2. 架构集成

  - 与现有简化版Clouds组件的差异较大
  - 需要重构现有的单层云系统
  - 动态patch与现有光照/时间系统的集成

  3. 视觉效果

  - 多层透明混合可能导致过度模糊
  - patch切换时可能产生视觉跳跃
  - 需要确保与地球表面的正确距离关系

  🚀 建议的简化实现

  基于你当前的Clouds.tsx简化版本，我建议分步实施：

  第一阶段：扩展现有组件

  // 在现有Clouds组件基础上添加多层支持
  export function CloudsWithLayers({ 
    radius,
    texture,
    position,
    // ... 现有参数
    numLayers = 3, // 新增：层数
    layerSpacing = 0.002, // 新增：层间距
  }: {
    // ... 现有类型
    numLayers?: number;
    layerSpacing?: number;
  }) {
    return (
      <>
        {Array.from({ length: numLayers }).map((_, i) => (
          <Clouds 
            key={i}
            radius={radius + i * layerSpacing}
            texture={texture}
            position={position}
            // 逐层调整参数
            strength={0.5 * (1 - i * 0.2)}
            displacementScale={0.05 * (1 + i * 0.3)}
            scrollSpeedU={0.0001 * (1 + i * 0.1)}
          />
        ))}
      </>
    );
  }

  第二阶段：添加动态patch

  export function CloudPatch({ 
    camera,
    earthRadius,
    texture,
    // ... patch专用参数
  }: CloudPatchProps) {
    const patchRef = useRef<THREE.Mesh>(null!);

    useFrame(() => {
      if (patchRef.current && camera) {
        // 计算patch位置
        const direction = new THREE.Vector3();
        camera.getWorldDirection(direction);
        const position =
  direction.clone().multiplyScalar(earthRadius + 0.03);
        patchRef.current.position.copy(position);
      }
    });

    return (
      <mesh ref={patchRef}>
        <sphereGeometry args={[0.15, 64, 64]} />
        <shaderMaterial
          uniforms={{ map: { value: texture } }}
          vertexShader={/* 置换着色器 */}
          fragmentShader={/* 边缘渐变着色器 */}
        />
      </mesh>
    );
  }

  📊 实施建议

  立即可行

  1. 先实现多层云：使用现有Clouds组件的3层版本
  2. 性能测试：确保帧率在45+ FPS
  3. 视觉调优：调整透明度和置换参数

  后续增强

  1. 添加动态patch：当相机距离地球表面较近时启用
  2. LOD系统：根据距离自动切换层数
  3. 性能优化：使用instanced rendering减少draw calls