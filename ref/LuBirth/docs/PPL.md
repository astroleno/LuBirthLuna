# 反向求解太阳光照方向方法概述

要在已知地面观测点（经度 λ、纬度 ϕ）和对应时间 t 的条件下，计算太阳光线入射方向，可按以下步骤进行。总体思路是利用**天文太阳位置算法**（Solar Position Algorithm, SPA）求出太阳在该时刻的**天顶角**（zenith angle）和**方位角**（azimuth angle），然后将其转换为所需坐标系下的光照方向矢量。

***

## 一、计算时刻的太阳天球位置

1. **将当地时间转换为协调世界时（UTC）**  
   若给定时区偏移 Δ （小时），则  
   $$
     t_{\rm UTC} = t_{\rm local} - Δ.
   $$

2. **计算儒略日（Julian Day, JD）**  
   采用以下公式（小于 1582 年前略有差异，可用通用算法）：  
   $$
     J = 367\,Y - \bigl\lfloor7\,(Y + \lfloor(M+9)/12\rfloor)/4\bigr\rfloor + \lfloor275\,M/9\rfloor + D + 1721013.5 + \frac{h + m/60 + s/3600}{24},
   $$  
   其中 (Y,M,D) 为年、月、日， (h,m,s) 为时分秒。

3. **计算儒略世纪数 $$T$$**  
   $$
     T = \frac{J - 2451545.0}{36525}.
   $$

4. **太阳平黄经与黄纬**  
   - **太阳平均黄经**  
     $$
       L_0 = 280.46646° + 36000.76983°\,T + 0.0003032°\,T^2.
     $$  
   - **太阳平均近点角**  
     $$
       M = 357.52911° + 35999.05029°\,T - 0.0001537°\,T^2.
     $$  
   - **黄赤交角近似值**  
     $$
       \varepsilon = 23.439291° - 0.0130042°\,T - 1.64\times10^{-7}°\,T^2 + 5.04\times10^{-7}°\,T^3.
     $$  
   - **太阳真黄经**  
     $$
       C = (1.914602° - 0.004817°\,T - 0.000014°\,T^2)\sin M + (0.019993° - 0.000101°\,T)\sin2M + 0.000289°\sin3M,
     $$  
     $$
       λ_{\odot} = L_0 + C.
     $$  
   - **太阳赤纬 δ**  
     $$
       \delta = \arcsin\bigl(\sin\varepsilon \,\sin λ_{\odot}\bigr).
     $$

5. **本地时角（Hour Angle）**  
   - **格林尼治平时角**  
     $$
       θ_{\rm G} = 280.46061837° + 360.98564736629°\,(J - 2451545) + 0.000387933°\,T^2 - \frac{T^3}{38710000}.
     $$  
   - **本地平时角**  
     $$
       H = θ_{\rm G} + λ - 180°.
     $$  
     结果需归一到 $$[-180°,180°]$$ 区间。

6. **太阳高度角 $$h$$ 与方位角 $$A$$**  
   - **高度角**  
     $$
       \sin h = \sinϕ\,\sinδ + \cosϕ\,\cosδ\,\cos H.
     $$  
     $$
       h = \arcsin(\sin h).
     $$  
   - **方位角**（从正北向东测量）  
     $$
       \sin A = \frac{-\cosδ\,\sin H}{\cos h},\quad
       \cos A = \frac{\sinδ - \sinϕ\,\sin h}{\cosϕ\,\cos h},
     $$  
     $$
       A = \arctan2(\sin A,\cos A).
     $$

***

## 二、构造太阳光照方向矢量

### 1. 局部东-北-天（ENU）坐标系

在观测点处定义右手系：
- X 轴指向东（East），  
- Y 轴指向北（North），  
- Z 轴指向天顶（Up）。

则太阳光线（从太阳指向地面）的**入射方向单位矢量**为  
$$
\mathbf{s}_{\rm ENU} = 
\begin{bmatrix}
\cos h \,\sin A \$$6pt]
\cos h \,\cos A \$$6pt]
\sin h
\end{bmatrix}.
$$

### 2. 地心地固坐标系（ECEF）转换

若需在 ECEF 坐标系中表示，则将 ENU 方向通过旋转矩阵 $$R$$ 转换，  
$$
\mathbf{s}_{\rm ECEF} = R(ϕ,λ)\,\mathbf{s}_{\rm ENU},
$$  
其中  
$$
R(ϕ,λ) = 
\begin{bmatrix}
-\,\sinλ & -\,\sinϕ\,\cosλ & \cosϕ\,\cosλ \$$4pt]
\cosλ & -\,\sinϕ\,\sinλ & \cosϕ\,\sinλ \$$4pt]
0 & \cosϕ & \sinϕ
\end{bmatrix}.
$$

***

## 三、总结

通过上述步骤，即可从已知**地面位置**（经度 λ、纬度 ϕ）和**UTC 时间** t，反向求解太阳光照的**方向矢量**，并按需求输出到局部 ENU 坐标系或全球 ECEF 坐标系。该方法兼具准确性与通用性，适用于影像校正、能量评估、可视化模拟等多种领域。