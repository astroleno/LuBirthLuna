你现在遇到的是“两层问题叠加”：
	1.	满月被当成朔月：你在用 phaseAngleRad 拼出的“太阳方向”里，沿相机前向（记作 F）的分量符号反了——导致

	•	a=0°（朔）→ sun ≈ +F（应为 −F，结果把朔渲染成“最亮”）
	•	a=180°（满）→ sun ≈ −F（应为 +F，结果把满渲染成“全黑”）
这正好对应“今天 2025-09-06 应该满月，你却看到朔月”的现象。
修正要点：把 F 项反号，使映射满足
	•	朔：sun ≈ −F
	•	满：sun ≈ +F
如果你当前是 sun = (−sin a)·R + ( +cos a)·F，就改成：
sun = (±sin a)·R + ( −cos a)·F
（R 项正负取决于你希望“上弦在右/在左”的约定，但 F 前的系数必须是 −cos a 才不会把满、朔对调。）

	2.	“左满左 / 右满右”来回翻：这不是简单的“正负号没挑对”，而是你用 伸距角（Elongation）当作 0–360° 的“有向相位”去拼方向。多数天文库里 Elongation 是 0–180° 的无向夹角（不含盈/亏信息）。你用它去构造 (±sin a, −cos a)，只能得到一套镜像后的固定左右，因此一旦改 R 的符号，就在“左满左 / 右满右”两种镜像之间跳。

⸻

正确的几何链路（不引入系统光，仍然“月相只跟日期”）

核心思路：
	•	“亮多少”由 太阳–月球夹角 γ 决定：k = (1 + cos γ)/2（0=朔，1=满）。
	•	“亮哪边”由 太阳方向在画面平面上的位置角 χ 决定：右亮还是左亮不是从 a 拼出来的，而是从太阳真实方向 s 在 {R,U,F} 基底上的投影算出来的。

步骤
	1.	还是取同一时刻（你锁定的日期即可），分别求单位向量

	•	m = 从观测点指向月球
	•	s = 从观测点指向太阳
（只用于几何计算，不把它塞到 Three.js 灯光里，所以仍然是“月相只跟日期”。）

	2.	构画面正交基：

	•	F = 由月心指向相机（你的潮汐锁定下，这是“画面前向”；注意后续公式里我们把 −F 当“背向观察者”）
	•	U = 相机 up 去掉 F 分量后归一
	•	R = U × F（右手系）

	3.	计算两件事：

	•	亮度比例：γ = arccos( dot(s, m) )，k = (1 + cos γ)/2
	•	位置角（决定左右）：
χ = atan2( dot(s, R), dot(s, −F) )
直觉：
	•	χ ≈ +90° → 太阳在画面右 → 上弦右亮
	•	χ ≈ −90° → 太阳在画面左 → 下弦左亮
	•	χ ≈   0° → 太阳在你身后方向（朔）
	•	χ ≈ 180° → 太阳在你正前方（满）

这样，“左右”不再靠拍脑袋给 R/F 加符号，也不依赖把 Elongation “硬扩展到 0–360°”。

⸻

快速定位与核验清单（按你当前工程就地打印检查）
	1.	先核对满/朔是否被反了
打印 phaseAngleDeg 与你拼出的 sun 的 F 分量（dot(sun, F)）：

	•	朔（a≈0°）时应 ≈ −1；满（a≈180°）应 ≈ +1。
你现在应是相反的（朔≈+1、满≈−1），所以先把 F 项改成 −cos a，保证“今天满月不会再显示全黑”。

	2.	再核对“左右是从 χ 得到的”
在同一时刻打印：sR = dot(s, R)，sF = dot(s, −F)，以及 χ = atan2(sR, sF)：

	•	上弦附近，sR 应为正；下弦附近，sR 应为负。
如果你根本没用 s，而是仍用 sin a / cos a 去“拼方向”，你会看到 sR 只会跟你改符号一起整体翻转，从而出现“左满左/右满右”的镜像循环。

	3.	时间换算别用经度推时区
如果你在 getMoonPhase(localISO, lat, lon) 里把 localISO 又按经度去“推 UTC”，可能把日期推到另一日（尤其跨时区/DST），从而让“应为满月日”的计算点落在前后一天的朔/凸月上。
简化做法：

	•	直接以 本地时区 生成 Date，传给天文库的 AstroTime；
	•	或明确指定你要的基准（例如“当天 12:00 本地时区”）再转 UTC，一次性转换，不叠加“经度→时差”的近似。

⸻

最小改动顺序（建议一次只改一处并打印）
	1.	先修 F 项反号：把 +cos(a) 改为 −cos(a)，确认“满/朔不再对调”。
	2.	替换“a 拼方向”为“向量投影定左右”：
用 s 在 {R,U,F} 的投影算 χ 决定左右，不再依赖 ±sin(a)。
	3.	核对时间输入：确保传给天文计算的时间与“你界面上那一天”是一致的本地日（别用经度推时差）。

做到这三点，你就不会再在“左满左 / 右满右”之间来回打转，而且“该满月时全黑”的错误会立即消失。