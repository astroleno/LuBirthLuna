基于你的系统架构，我设计一个实现方案：

  核心问题分析

  当前状态：
  - PIP通过动态相机位置模拟月相变化（假象）
  - 主场景月球只有潮汐锁定，缺少时间驱动的自转
  - 两者不一致导致视觉差异

  解决方案设计

  1. 统一月相计算机制

  建立月相时间映射：
  - 创建"月相时间轴"：将日期时间映射到月球自转角度
  - 计算公式：moonRotationAngle = f(date, time, moonPhase)
  - 这个角度同时驱动主场景月球和PIP相机

  2. 主场景月球自转逻辑

  分层旋转控制：
  - 基础层：潮汐锁定（朝向地球）
  - 自转层：基于月相时间的额外自转
  - 合成：finalRotation = tidalLockRotation + phaseRotation

  关键点：
  - 自转轴要正确（通常是Y轴）
  - 自转速度要与月相周期匹配
  - 保持潮汐锁定效果不被破坏

  3. PIP相机跟随策略

  相机相对定位：
  - 不再独立计算相机位置
  - 基于月球当前的旋转状态，计算相对观察位置
  - 确保相机始终从"地球方向"观察

  同步机制：
  - PIP相机使用与主场景相同的月相时间
  - 相机位置计算基于月球当前的旋转四元数
  - 保持固定的观察距离和角度

  4. 时间同步系统

  统一时间源：
  - 创建全局月相时间管理器
  - 主场景月球和PIP都订阅同一时间源
  - 确保两者完全同步

  插值平滑：
  - 避免时间跳跃造成的旋转突变
  - 使用插值算法平滑过渡
  - 保持视觉连贯性

  5. 验证机制

  一致性检查：
  - 主场景与PIP的月相角度对比
  - 亮度分布一致性验证
  - 潮汐锁定状态确认

  调试工具：
  - 实时显示月相角度和时间映射
  - 可视化旋转轴和观察角度
  - 性能监控

  这个方案的核心是建立统一的时间驱动机制，让主场景月球和PIP都基于相同的月相时间工作，而不是现在的分离状态。