# LuBirth 客户端开发计划

## 项目概述
基于现有SimpleTest.tsx的完整功能，开发面向客户的简化版本，保留所有核心功能但提供简洁的用户界面。

## 核心功能保留
- ✅ 完整的地球月球天文计算系统
- ✅ 出生点对齐算法（精度≤0.5°）
- ✅ 三级地点选择器（可搜索）
- ✅ 出生时间选择器
- ✅ 对齐并放大功能
- ✅ 实时天文现象渲染

## 客户版界面设计

### 主要功能区域
1. **地点选择区域**
   - 三级联动选择器：国家 → 省/州 → 城市
   - 搜索功能：支持城市名称、拼音搜索
   - 常用地点快速选择

2. **时间设置区域**
   - 出生日期选择器
   - 出生时间选择器（精确到分钟）
   - 时区自动计算显示

3. **主要操作按钮**
   - 📍 对齐到出生点
   - 🔍 放大查看
   - 🔄 实时模式切换
   - 🏠 重置视图

4. **显示选项**
   - ☁️ 显示/隐藏云层
   - ⭐ 显示/隐藏星空
   - 🌙 显示/隐藏月球
   - 🌅 显示/隐藏晨昏线

### 界面布局
```
┌─────────────────────────────────────┐
│            LuBirth 标题             │
├─────────────┬───────────────────────┤
│ 地点选择    │  [国家 ▼] [省/州 ▼]    │
│             │  [城市 ▼] [🔍搜索]    │
│             │                       │
│ 时间设置    │  [📅 1990-01-01]      │
│             │  [⏰ 12:00]          │
│             │  时区: UTC+8          │
│             │                       │
│ 主要操作    │  [📍 对齐到出生点]    │
│             │  [🔄 实时模式]        │
│             │  [🏠 重置视图]        │
│             │                       │
│ 显示选项    │  ☁️ 云层  ⭐ 星空      │
│             │  🌙 月球  🌅 晨昏线  │
└─────────────┴───────────────────────┘
```

## 技术实现方案

### 1. 模式切换机制
```typescript
const [customerMode, setCustomerMode] = useState(false);
// 开发环境显示切换按钮，生产环境默认客户模式
```

### 2. UI组件策略
- **保留**: LocationSelector、时间选择器、对齐按钮核心逻辑
- **简化**: 移除200+个技术参数滑块，使用预设优化值
- **隐藏**: 调试面板、性能监控、开发者工具
- **优化**: 界面布局、交互流程、视觉反馈

### 3. 功能组织
- **客户可见**: 地点选择、时间设置、对齐操作、基础显示选项
- **功能保留**: 所有天文计算、alignment算法、渲染系统
- **开发调试**: 通过customerMode状态控制显示/隐藏

## 开发阶段

### 第一阶段：基础界面重构
- [ ] 添加customerMode状态控制
- [ ] 设计并实现客户版UI布局
- [ ] 简化控制面板，只保留客户功能
- [ ] 优化LocationSelector组件

### 第二阶段：功能验证
- [ ] 测试地点选择器完整功能
- [ ] 验证时间选择与时区计算
- [ ] 确认对齐算法精度保持
- [ ] 测试实时模式切换

### 第三阶段：体验优化
- [ ] 添加加载状态和错误处理
- [ ] 实现平滑的动画过渡
- [ ] 优化移动端适配
- [ ] 添加用户引导提示

### 第四阶段：部署准备
- [ ] 生产环境配置（默认customerMode=true）
- [ ] 性能优化和资源压缩
- [ ] 错误监控和日志收集
- [ ] 用户文档和使用说明

## 预设参数配置

### 地球渲染参数
```typescript
const earthDefaults = {
  scale: 0.33,
  position: [0, 0, 0],
  cloudsEnabled: true,
  atmosphereEnabled: true
};
```

### 月球显示参数
```typescript
const moonDefaults = {
  distance: 14,
  radius: 0.68,
  showPhase: true,
  autoPosition: true
};
```

### 相机控制参数
```typescript
const cameraDefaults = {
  distance: 15,
  autoAlign: true,
  smoothTransition: true
};
```

## 质量标准

### 功能要求
- 出生点对齐误差 ≤ 0.5°
- 地点选择器响应时间 < 500ms
- 对齐操作完成时间 < 2秒
- 支持移动端触摸操作

### 兼容性要求
- 现代浏览器（Chrome 80+, Safari 13+, Firefox 75+）
- 移动端iOS Safari和Android Chrome
- 响应式设计，支持不同屏幕尺寸

### 性能要求
- 首次加载时间 < 5秒
- 3D渲染帧率 ≥ 30fps
- 内存使用 < 500MB
- 支持WebGL 2.0

## 风险控制

### 技术风险
- **天文计算精度**：保留现有验证算法，定期校验
- **性能问题**：预设优化参数，避免复杂配置导致性能下降
- **兼容性问题**：逐步降级方案，WebGL 1.0兼容

### 产品风险
- **功能缺失**：保持完整功能库，只是UI隐藏
- **用户体验**：简洁化设计可能导致高级用户不满
- **维护成本**：单文件架构降低维护复杂度

## 时间规划

- **第1周**: 界面重构和模式切换实现
- **第2周**: 功能验证和参数调优
- **第3周**: 用户体验优化和bug修复
- **第4周**: 部署准备和文档完善

## 成功指标

- [ ] 客户版功能完整性100%
- [ ] UI简洁性评分 > 4.5/5
- [ ] 操作流程复杂度降低60%
- [ ] 用户上手时间 < 2分钟
- [ ] 开发维护成本降低30%

## 实现方案确认

### 模式切换机制
- **默认访问**: 客户端模式（极简UI）
- **?dev=1**: 开发者模式（完整功能）

### 参数继承策略
- **开发者模式**: 完全控制所有200+个参数
- **客户端模式**: 
  - 继承开发者模式预设的"最佳参数"
  - 只独立控制必要参数：
    - 观察点坐标
    - UTC时间
    - 出生点坐标
    - 图层开关（云层/星空/月球）

### 功能差异
- **客户端模式**:
  - 地点选择器 = 出生点 = 观察点（三合一）
  - 出生时间影响全局时间
  - 简洁UI：地点时间输入 + 基础开关 + 主要操作

- **开发者模式**: 
  - 保持现有逻辑不变
  - 地点选择器只用于对齐
  - 时间选择器独立
  - 出生点和观察点分离

---

*文档最后更新: 2025-09-14*
*状态: 实施阶段*