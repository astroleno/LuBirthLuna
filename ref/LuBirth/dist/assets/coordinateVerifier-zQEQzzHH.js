import{c as h,b as d,M as c,P as p,E as m,a as g}from"./index-d3XrTYz9.js";class x{static verifyBirthPointMapping(e,t){const a=[],{p:o}=h(e,t),i=this.getExpectedRegion(e,t),n=this.getRegionFromWorldCoord(o);Math.abs(o.length()-1)>.001&&a.push(`ä¸–ç•Œåæ ‡ä¸æ˜¯å•ä½å‘é‡: ${o.length().toFixed(4)}`);const s=Math.sin(c.degToRad(t));return Math.abs(o.y-s)>.001&&a.push(`Yè½´çº¬åº¦æ˜ å°„é”™è¯¯: æœŸæœ› ${s.toFixed(4)}, å®é™… ${o.y.toFixed(4)}`),i!==n&&a.push(`åŒºåŸŸæ˜ å°„é”™è¯¯: æœŸæœ› ${i}, å®é™… ${n}`),{isValid:a.length===0,errors:a,worldCoord:o,expectedRegion:i,actualRegion:n}}static verifyCameraAlignment(e,t,a=15){const o=[],i=d({longitudeDeg:e,latitudeDeg:t,alphaDeg:10});Math.abs(i.yaw)>180&&o.push(`Yawè§’åº¦è¶…å‡ºèŒƒå›´: ${i.yaw.toFixed(2)}Â°`),Math.abs(i.pitch)>90&&o.push(`Pitchè§’åº¦è¶…å‡ºèŒƒå›´: ${i.pitch.toFixed(2)}Â°`);const n=this.projectBirthPointToScreen(e,t,i,a),s=.5,r=.4,l=.15;return Math.abs(n.x-s)>l&&o.push(`å‡ºç”Ÿç‚¹Xä½ç½®åç¦»ä¸­å¿ƒ: ${n.x.toFixed(3)} vs ${s}`),Math.abs(n.y-r)>l&&o.push(`å‡ºç”Ÿç‚¹Yä½ç½®åç¦»ç›®æ ‡: ${n.y.toFixed(3)} vs ${r}`),{isValid:o.length===0,errors:o,cameraYaw:i.yaw,cameraPitch:i.pitch,birthPointScreenPos:n}}static verifyKnownLocations(){const t=[{name:"ä¸Šæµ·",lon:121.47,lat:31.23},{name:"åŒ—äº¬",lon:116.41,lat:39.9},{name:"çº½çº¦",lon:-74.01,lat:40.71},{name:"ä¼¦æ•¦",lon:-.13,lat:51.51},{name:"ä¸œäº¬",lon:139.69,lat:35.69},{name:"æ‚‰å°¼",lon:151.21,lat:-33.87},{name:"æœ¬åˆå­åˆçº¿",lon:0,lat:0},{name:"å›½é™…æ—¥æœŸå˜æ›´çº¿",lon:180,lat:0}].map(o=>{const i=this.verifyBirthPointMapping(o.lon,o.lat),n=this.verifyCameraAlignment(o.lon,o.lat);return{name:o.name,location:o,mappingValid:i.isValid,alignmentValid:n.isValid,errors:[...i.errors,...n.errors]}}),a=t.filter(o=>o.mappingValid&&o.alignmentValid).length;return{totalTests:t.length,passedTests:a,results:t}}static getExpectedRegion(e,t){return e>=100&&e<=140&&t>=20&&t<=50?"ä¸œäºš":e>=-100&&e<=-70&&t>=25&&t<=45?"åŒ—ç¾ä¸œéƒ¨":e>=-10&&e<=20&&t>=35&&t<=60?"è¥¿æ¬§":e>=140&&e<=180&&t>=-40&&t<=-30?"æ¾³æ´²":Math.abs(e)<10&&Math.abs(t)<10?"èµ¤é“éæ´²":Math.abs(e-180)<10||Math.abs(e+180)<10?"å¤ªå¹³æ´‹":"å…¶ä»–åœ°åŒº"}static getRegionFromWorldCoord(e){const t=Math.atan2(e.x,e.z),a=Math.asin(c.clamp(e.y,-1,1)),o=c.radToDeg(t),i=c.radToDeg(a);return this.getExpectedRegion(o,i)}static projectBirthPointToScreen(e,t,a,o){const{p:i}=h(e,t),n=new p(45,1,.1,1e3);n.position.set(0,0,o);const s=new m(c.degToRad(a.pitch),c.degToRad(a.yaw),c.degToRad(a.roll),"YXZ");n.setRotationFromEuler(s),n.updateMatrixWorld();const r=i.clone().project(n);return new g((r.x+1)*.5,(1-r.y)*.5)}static runFullVerification(){console.group("ğŸ” åæ ‡éªŒè¯æµ‹è¯•å¥—ä»¶");const e=this.verifyKnownLocations();console.log(`ğŸ“ åœ°ç‚¹æµ‹è¯•: ${e.passedTests}/${e.totalTests} é€šè¿‡`),e.results.forEach(n=>{const s=n.mappingValid&&n.alignmentValid?"âœ…":"âŒ";console.log(`  ${s} ${n.name} (${n.location.lon}Â°, ${n.location.lat}Â°)`),n.errors.length>0&&n.errors.forEach(r=>console.warn(`    âš ï¸ ${r}`))}),console.group("ğŸ¯ ä¸Šæµ·å…³é”®éªŒè¯");const t=this.verifyBirthPointMapping(121.47,31.23),a=this.verifyCameraAlignment(121.47,31.23);console.log("æ˜ å°„éªŒè¯:",t.isValid?"âœ…":"âŒ"),console.log("å¯¹é½éªŒè¯:",a.isValid?"âœ…":"âŒ"),t.isValid||t.errors.forEach(n=>console.warn(`  æ˜ å°„é—®é¢˜: ${n}`)),a.isValid||a.errors.forEach(n=>console.warn(`  å¯¹é½é—®é¢˜: ${n}`)),console.log("ä¸–ç•Œåæ ‡:",{x:+t.worldCoord.x.toFixed(4),y:+t.worldCoord.y.toFixed(4),z:+t.worldCoord.z.toFixed(4)}),console.log("ç›¸æœºå‚æ•°:",{yaw:a.cameraYaw.toFixed(2)+"Â°",pitch:a.cameraPitch.toFixed(2)+"Â°"}),console.log("å±å¹•ä½ç½®:",{x:a.birthPointScreenPos.x.toFixed(3),y:a.birthPointScreenPos.y.toFixed(3)}),console.groupEnd();const o=e.passedTests/e.totalTests,i=o>=.8?"ğŸ‰ ä¼˜ç§€":o>=.6?"âš ï¸ è‰¯å¥½":"âŒ éœ€æ”¹è¿›";console.log(`
ğŸ“Š æ€»ä½“éªŒè¯ç»“æœ: ${i} (${(o*100).toFixed(1)}%)`),console.groupEnd()}}export{x as CoordinateVerifier};
